{"bsonType":"object","required":["community_id","title","content","publish_user_id"],"permission":{"read":true,"create":true,"update":"doc.publish_user_id == auth.uid && doc.status == 0","delete":"doc.publish_user_id == auth.uid || 'admin' in auth.role"},"properties":{"_id":{"description":"自动生成的公告ID"},"community_id":{"bsonType":"string","title":"社区ID","foreignKey":"community._id","description":"发布公告的社区"},"title":{"bsonType":"string","title":"公告标题","minLength":2,"maxLength":200,"label":"公告标题","errorMessage":{"required":"{label}必填","minLength":"{label}长度不能少于{minLength}位","maxLength":"{label}长度不能大于{maxLength}位"}},"content":{"bsonType":"string","title":"公告内容","minLength":10,"maxLength":5000,"label":"公告内容","errorMessage":{"required":"{label}必填","minLength":"{label}字数不能少于{minLength}字","maxLength":"{label}字数不能超过{maxLength}字"}},"summary":{"bsonType":"string","title":"公告摘要","maxLength":300,"description":"公告的简要描述，用于列表页显示"},"notice_type":{"bsonType":"string","title":"公告类型","enum":["urgent","maintenance","activity","policy","general","announcement"],"enumText":["紧急通知","维修公告","活动通知","政策通知","一般公告","重要公告"],"default":"general","label":"公告类型"},"priority":{"bsonType":"int","title":"优先级","enum":[1,2,3],"enumText":["高","中","低"],"default":2,"description":"1-高优先级，2-中优先级，3-低优先级"},"publish_user_id":{"bsonType":"string","title":"发布人ID","foreignKey":"user._id","description":"发布公告的用户ID"},"publisher_name":{"bsonType":"string","title":"发布人姓名","description":"发布人的显示姓名"},"target_audience":{"bsonType":"array","title":"目标受众","items":{"bsonType":"string","enum":["all","owners","tenants","specific_building","specific_unit"]},"default":["all"],"description":"公告的目标受众范围"},"target_buildings":{"bsonType":"array","title":"目标楼栋","items":{"bsonType":"string"},"description":"如果是特定楼栋公告，指定楼栋号列表"},"images":{"bsonType":"array","title":"公告图片","description":"公告配图文件ID列表","items":{"bsonType":"string","format":"fileid","label":"图片文件ID"},"maxCount":9},"cover_image":{"bsonType":"string","title":"封面图片","format":"fileid","description":"公告封面图片ID，用于列表页显示"},"attachments":{"bsonType":"array","title":"附件文件","description":"公告附件文件ID列表","items":{"bsonType":"object","properties":{"file_id":{"bsonType":"string","format":"fileid","title":"文件ID"},"file_name":{"bsonType":"string","title":"文件名称"},"file_size":{"bsonType":"int","title":"文件大小"},"file_type":{"bsonType":"string","title":"文件类型"}}},"maxCount":5},"is_top":{"bsonType":"bool","title":"是否置顶","default":false,"description":"是否在列表中置顶显示"},"is_important":{"bsonType":"bool","title":"是否重要","default":false,"description":"重要公告会特殊标识显示"},"allow_comment":{"bsonType":"bool","title":"允许评论","default":true,"description":"是否允许用户评论此公告"},"status":{"bsonType":"int","title":"发布状态","enum":[0,1,2,3],"enumText":["草稿","已发布","已撤回","已过期"],"default":0,"label":"状态"},"publish_time":{"bsonType":"timestamp","title":"发布时间","description":"公告正式发布的时间"},"expire_time":{"bsonType":"timestamp","title":"过期时间","description":"公告的过期时间，过期后自动不显示"},"view_count":{"bsonType":"int","title":"查看次数","default":0,"minimum":0,"description":"公告被查看的次数"},"like_count":{"bsonType":"int","title":"点赞数","default":0,"minimum":0,"description":"公告被点赞的次数"},"comment_count":{"bsonType":"int","title":"评论数","default":0,"minimum":0,"description":"公告的评论数量"},"tags":{"bsonType":"array","title":"标签","items":{"bsonType":"string"},"maxCount":10,"description":"公告的标签列表"},"create_time":{"bsonType":"timestamp","title":"创建时间","defaultValue":{"$env":"now"},"forceDefaultValue":true},"update_time":{"bsonType":"timestamp","title":"更新时间","defaultValue":{"$env":"now"}}},"indexes":[{"name":"idx_community_status_priority","fields":["community_id","status","priority"]},{"name":"idx_publish_time","fields":["publish_time"]},{"name":"idx_expire_time","fields":["expire_time"]},{"name":"idx_top_priority","fields":["is_top","priority"]},{"name":"idx_notice_type","fields":["notice_type"]},{"name":"idx_view_count","fields":["view_count"]}]}