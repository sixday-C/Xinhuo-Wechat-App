{"bsonType":"object","required":["filename","filesize","upload_user_id"],"permission":{"read":"doc.upload_user_id == auth.uid || doc.is_public == true || doc.collaborators.includes(auth.uid) || 'admin' in auth.role","create":"auth.uid != null","update":"doc.upload_user_id == auth.uid || doc.collaborators.includes(auth.uid)","delete":"doc.upload_user_id == auth.uid || 'admin' in auth.role"},"properties":{"_id":{"description":"自动生成的文件ID"},"filename":{"bsonType":"string","title":"文件名","minLength":1,"maxLength":255,"label":"文件名","errorMessage":{"required":"{label}必填","maxLength":"{label}长度不能超过{maxLength}位"}},"original_filename":{"bsonType":"string","title":"原始文件名","description":"用户上传时的原始文件名"},"file_extension":{"bsonType":"string","title":"文件扩展名","description":"文件的扩展名，如 .jpg, .pdf 等"},"mime_type":{"bsonType":"string","title":"MIME类型","description":"文件的MIME类型"},"filesize":{"bsonType":"int","title":"文件大小","minimum":1,"description":"文件大小（字节）"},"file_url":{"bsonType":"string","title":"文件URL","format":"url","description":"文件的访问URL地址"},"cloud_file_id":{"bsonType":"string","title":"云存储文件ID","description":"云存储服务返回的文件ID"},"upload_user_id":{"bsonType":"string","title":"上传用户ID","foreignKey":"user._id","description":"上传文件的用户ID"},"community_id":{"bsonType":"string","title":"关联社区ID","foreignKey":"community._id","description":"文件关联的社区ID（可选）"},"file_category":{"bsonType":"string","title":"文件分类","enum":["avatar","feedback_image","notice_image","notice_attachment","reply_image","other"],"enumText":["头像","反馈图片","公告图片","公告附件","回复图片","其他"],"default":"other","description":"文件的用途分类"},"related_id":{"bsonType":"string","title":"关联记录ID","description":"关联的业务记录ID（如反馈ID、公告ID等）"},"is_public":{"bsonType":"bool","title":"是否公开","default":false,"description":"文件是否公开访问"},"is_temporary":{"bsonType":"bool","title":"是否临时文件","default":false,"description":"是否为临时文件（临时文件会定期清理）"},"expire_time":{"bsonType":"timestamp","title":"过期时间","description":"临时文件的过期时间"},"download_count":{"bsonType":"int","title":"下载次数","default":0,"minimum":0,"description":"文件被下载的次数"},"file_hash":{"bsonType":"string","title":"文件哈希","description":"文件的MD5或SHA256哈希值，用于去重"},"image_info":{"bsonType":"object","title":"图片信息","description":"如果是图片文件，记录图片的详细信息","properties":{"width":{"bsonType":"int","title":"图片宽度"},"height":{"bsonType":"int","title":"图片高度"},"format":{"bsonType":"string","title":"图片格式"}}},"upload_ip":{"bsonType":"string","title":"上传IP","description":"文件上传时的客户端IP地址"},"status":{"bsonType":"int","title":"文件状态","enum":[0,1,2,3],"enumText":["正常","已删除","病毒检测中","违规文件"],"default":0,"description":"文件状态"},"upload_time":{"bsonType":"timestamp","title":"上传时间","defaultValue":{"$env":"now"},"forceDefaultValue":true},"update_time":{"bsonType":"timestamp","title":"更新时间","defaultValue":{"$env":"now"}}},"indexes":[{"name":"idx_upload_user_time","fields":["upload_user_id","upload_time"]},{"name":"idx_community_category","fields":["community_id","file_category"]},{"name":"idx_related_category","fields":["related_id","file_category"]},{"name":"idx_hash","fields":["file_hash"]},{"name":"idx_status_expire","fields":["status","expire_time"]},{"name":"idx_temporary_expire","fields":["is_temporary","expire_time"]}]}